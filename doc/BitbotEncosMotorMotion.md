# Encos电机模式简介
>
> 该文档节选自Encos电机官方文档，详细信息请参阅Encos官方文档。

## 运动模式

发送该指令调用的是力位混合控制，最终输出电流给电机，电流由如下三个部分组成：

\f{eqnarray*}{
    I=(Kd \cdot (TargetPos-CurrentPos)+Kd \cdot (TargetVel-CurrentVel)+Torque)/K_t
\f}

其中指令中的KP、KD参数是随时更改的参数，KT是电机扭矩常数。本模式主要用于足式机器人的控制。空载下KP参考值为15，KD参考值为0.5。(不同型号电机对应的电流范围、扭矩范围是不同的)

![](https://opensource-doc-1253829354.cos.ap-beijing.myqcloud.com/libBitbotEncos/MotionMode.png)

## 位置伺服模式

给定期望位置大于±180度，即可多圈转，但是重启上电会重置圈数。
伺服控制模式为三环控制，最内环为电流环，电流环主要有PI控制器控制，参数用户不可更改。位置环控制其实为KP、KD控制，KP在此系统中称为反馈补偿增益，KD称为阻尼系数。内环速度环调用伺服控制模式速度控制，采用的是Encos自行研发的自适应算法，不用频繁改参数去适应负载。位置环的KP、KD对应VESCtool软件中的取值范围为0~0.1，参考值KP：0.006，KD：0。伺服位置控制有三个输入参数，分别为期望位置P、期望速度V和电流阈值I，即电机从当前位置P0按期望的速度V运转。到期望位置P，从P0到P的过程中，速度最大值为V，在P0和P特别小，而V设置的过大的情况下，实际运行时速度可能无法达到V。同时在P0到P过程中，电机的最大电流为I，及产生的最大扭矩Tmax=I*扭矩常数。若遇到的负载超过该扭矩，则电机堵转并保持力矩Tmax。

![](https://opensource-doc-1253829354.cos.ap-beijing.myqcloud.com/libBitbotEncos/PositionMode.png)

## 速度伺服模式

速度环控制为磁链观测控制，参数较多，提供给客户更改的参数为磁链观测增益和扰动补偿系数，磁链观测增益建议取值范围为0.0001~1，参考值为0.12，扰动补偿系数建议取值范围为0~1，参考值为0.08。使用出厂设置的值，经过测试已能适应大部分负载情况，建议用户不要随意改变该值，在有相关经验后或在官方技术指导下再更改（以上所述取值范围均对VESCtool上的设置而言，对于CAN中的设置范围请查看通信协议）。

![](https://opensource-doc-1253829354.cos.ap-beijing.myqcloud.com/libBitbotEncos/VelocityMode.png)

## 力矩/电流模式

用电流/力矩控制电机时，电机只要转动，必然会持续加速至最高速，调试时应当注意安全！
